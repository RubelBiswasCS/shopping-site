{% extends 'store/base.html' %}

{% block content %}
<div class="gen-div">
    <section class="products">
        
        {% for p in products %}
        <div class="product-card">
            <figure class="card-image">
                {% load static %}
                <img src="{% static 'store/img/headphone-nbg.png' %}" alt="headphone image">
            </figure>
            <small>{{p.product_name}}</small>
            <p>{{p.unit_price}}$</p>
            <button id="add-btn" value="{{p.id}}" class="add-btn" type="submit" name="button" >Add to Cart</button>
        </div>
        {% endfor %}
        <!-- <div id="cart" style="height:100px; width:100px; background: red;">

        </div> -->
        

    </section>
    <section id="cart" class="cart" >
        <header class="cart-header">
            <button id="close-cart" class="close-cart">
                x
            </button>
        </header>
        <div class="cart-container" id="cart-container">
          
            
            <div class="cart-items" id='cart-items'>
                <!-- <div class="cart-item" id="cart-item">
                    <section class="item-img">
        
                    </section>
                    <section class="name" id="current-p-name">
                        
                    </section>
                    <section class="price">
                        
                    </section>
                    <section class="item-action">
                        
                    </section>
                </div> -->
            </div>
           
            
            <button class="checkout-btn" id="checkout">Checkout</button>
        </div>
    </section>
</div>
    <script>
        //function for cart view
        $(document).ready(function(){
               setInterval(function(){
                   $.ajax({
                       method:'POST',
                       url: "{% url 'cart' %}",
                       data : {
                            csrfmiddlewaretoken: '{{csrf_token}}',
                            user_id: '{{ request.user.id }}',
                       },
                       success:function(response){

                        var myObj = JSON.parse(response);
                           console.log("Success get data");
                        //    console.log(myObj[1].product_name);
                           $("#cart-items").empty();
                           
                           for (var i=0 in myObj){
                            console.log(myObj[i].product_name);
                               var temp = `<div class="cart-item" id="cart-item">
                    <section class="item-unit flex-center">
                        ${myObj[i].quantity}
                    </section>
                    <section class="name flex-center" id="current-p-name">
                        ${myObj[i].product_name}
                    </section>
                    <section class="price flex-center">
                        ${myObj[i].price}$
                    </section>
                    <section class="item-action flex-center">
                        <button class='rm-cart-item' id='rm-cart-item' value=" ${myObj[i].product_id}">x</button>
                    </section>
                </div>`;
                // $("#cart-items").append("<p>Hi</p>");
                            $("#cart-items").append(temp);
                            
                            console.log("Success call");
                           };
                           
                           

                       },
                       error:function(){
                           console.log("An Error Occured");

                       },
                   });

               },1000);
           });

        // show and hide cart
        $("#cart-btn").click(function () {
                $("#cart").toggle("slow");
                // $( ".products" ).addClass( "wd-75" );
            });

            $("#close-cart").click(function () {
                $("#cart").toggle("slow");
                // $( ".products" ).addClass( "wd-75" );
            });    

        //fuction for add item to the cart
        $(document).on("click","#add-btn",function(e){
            // var user_id = '{{ request.user.id }}';
            var id = $(this).val();
               e.preventDefault();
               $.ajax({
                   method:"POST",
                   url: "{% url 'add-to-cart' %}",
                   data:{
                        user_id : '{{ request.user.id }}',
                        product_id : $(this).val(),
                        csrfmiddlewaretoken: '{{ csrf_token}}',

                        
                   },
                   
                  

                success: function(response){
                    var myObj = JSON.parse(response);
                    console.log(myObj.user_id+' '+myObj.product_id);
                    console.log('data successfully send');
                },
                error: function(){
                    console.log("something went wrong");
                },
               });

           });
        //    remove cart item

        $(document).on("click","#rm-cart-item",function(e){
            // var user_id = '{{ request.user.id }}';
            var id = $(this).val();
               e.preventDefault();
               $.ajax({
                   method:"POST",
                   url: "{% url 'remove-cart-item' %}",
                   data:{
                        user_id : '{{ request.user.id }}',
                        product_id : $(this).val(),
                        csrfmiddlewaretoken: '{{ csrf_token}}',

                        
                   },
                   
                  

                success: function(response){
                    console.log(response);
                },
                error: function(){
                    console.log("error while delete item");
                },
               });

           });
    </script>
{% endblock %}