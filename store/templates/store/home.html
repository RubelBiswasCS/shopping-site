{% extends 'store/base.html' %}

{% block content %}
<div class="gen-div">
    <section class="products">
        
        {% for p in products %}
        <div class="product-card">
            <figure class="card-image">
                {% load static %}
                <img src="{% static 'store/img/headphone-nbg.png' %}" alt="headphone image">
            </figure>
            <small>{{p.product_name}}</small>
            <p>{{p.unit_price}}$</p>
            <button id="add-btn" value="{{p.id}}" class="add-btn" type="submit" name="button" >Add to Cart</button>
        </div>
        {% endfor %}
        <!-- <div id="cart" style="height:100px; width:100px; background: red;">

        </div> -->
        

    </section>
    <section id="cart" class="cart" >
        <header class="cart-header">
            <button id="close-cart" class="close-cart">
                x
            </button>
        </header>
        <div class="cart-container">
            <div class="cart-item">
                <section class="item-img">
    
                </section>
                <section class="name" id="current-p-name">
                    
                </section>
                <section class="price">
                    
                </section>
                <section class="item-action">
                    
                </section>
            </div>
            <div class="cart-item">
                <p>item 1</p>
            </div>
            <button class="checkout-btn" id="checkout">Checkout</button>
        </div>
    </section>
</div>
    <script>
        //function for cart view
        $(document).ready(function(){
               setInterval(function(){
                   $.ajax({
                       method:'POST',
                       url: "{% url 'cart' %}",
                       data : {
                            csrfmiddlewaretoken: '{{csrf_token}}',
                            user_id: '{{ request.user.id }}',
                       },
                       success:function(response){
                        var myObj = JSON.parse(response);
                           console.log("Success get data");
                           console.log(myObj.cart_items)
                           $("#current-p-name").empty();
                           $("#current-p-name").append(myObj.cart_items);

                       },
                       error:function(){
                           console.log("An Error Occured");

                       },
                   });

               },500);
           });

        // show and hide cart
        $("#cart-btn").click(function () {
                $("#cart").toggle("slow");
                // $( ".products" ).addClass( "wd-75" );
            });

            $("#close-cart").click(function () {
                $("#cart").toggle("slow");
                // $( ".products" ).addClass( "wd-75" );
            });    

        //fuction for add item to the cart
        $(document).on("click","#add-btn",function(e){
            // var user_id = '{{ request.user.id }}';
            var id = $(this).val();
               e.preventDefault();
               $.ajax({
                   method:"POST",
                   url: "{% url 'add-to-cart' %}",
                   data:{
                        user_id : '{{ request.user.id }}',
                        product_id : $(this).val(),
                        csrfmiddlewaretoken: '{{ csrf_token}}',

                        
                   },
                   
                  

                success: function(response){
                    var myObj = JSON.parse(response);
                    console.log(myObj.user_id+' '+myObj.product_id);
                    console.log('data successfully send');
                },
                error: function(){
                    console.log("something went wrong");
                },
               });

           });
    </script>
{% endblock %}